<!-- This file is for referencing while you are making a PNotify module. -->
<script context="module">
  import { icons } from './PNotifyCore';

  // This is the key you use for registering your module with PNotify.
  export const key = 'Reference';

  // This is the position your component will be placed inside the notice's DOM
  // structure. It can be 'PrependContainer', 'PrependContent', 'AppendContent',
  // or 'AppendContainer'.
  export const position = 'AppendContent';

  // This if the default values of your options.
  export const defaults = {
    // Provide a thing for stuff. Turned off by default.
    putThing: false,
    // If you are displaying any text, you should use a labels options to
    // support internationalization.
    labels: {
      text: 'Spin Around'
    }
  };

  // This is where you would add any styling or icons classes you are using in your code.
  Object.assign(icons.bootstrap3, {
    refresh: 'glyphicon glyphicon-refresh'
  });
  Object.assign(icons.fontawesome4, {
    refresh: 'fa fa-refresh'
  });
  Object.assign(icons.fontawesome5, {
    refresh: 'fas fa-sync'
  });
</script>

{#if putThing} <!-- We want to check to make sure the notice should include our thing. -->
  <!--
  We're going to create a button that will be appended to the notice.
  It will be disabled by default, so we can enable it on mouseover.
  -->
  <button
      class="ui-pnotify-action-button ui-pnotify-reference-button {self.getStyle('btn')} {self.getStyle('btn-secondary')}"
      type="button"
      disabled="{!mouseIsIn}"
      on:click={doSomething}>
    <i class={self.getIcon('refresh')} />&nbsp;{labels.text}
  </button>
  <!-- Since our button is floated, we have to add a clearing div. -->
  <div class="ui-pnotify-reference-clearing" />
{/if}

<script>
  // The PNotify notice.
  export let self = null;

  // Your options must be exported and set to the defaults.
  export let putThing = defaults.putThing;
  export let labels = defaults.labels;

  // Here you can define variables not meant to be exported as options.
  let mouseIsIn = false;

  self.on('mouseenter', () => mouseIsIn = true);
  self.on('mouseleave', () => mouseIsIn = false);

  // I have nothing to put in these, just showing you that they exist. You
  // won't need to include them if you aren't using them.
  self.on('pnotify:beforeOpen', () => {
    // Called before the notice is opened.
  });
  self.on('pnotify:afterOpen', () => {
    // Called after the notice is opened.
  });
  self.on('pnotify:beforeClose', () => {
    // Called before the notice is closed.
  });
  self.on('pnotify:afterClose', () => {
    // Called after the notice is closed.
  });
  self.on('pnotify:beforeDestroy', () => {
    // Called before the notice is destroyed.
  });
  self.on('pnotify:afterDestroy', () => {
    // Called after the notice is destroyed.
  });

  function doSomething () {
    // Spin the notice around.
    let curAngle = 0;
    const timer = setInterval(() => {
      curAngle += 10;
      if (curAngle === 360) {
        curAngle = 0;
        clearInterval(timer);
      }
      self.refs.elem.style.transform = 'rotate(' + curAngle + 'deg)';
    }, 20);
  }
</script>

<style>
  .ui-pnotify-reference-button {
    float: right;
    margin-top: 1em;
  }
  .ui-pnotify-reference-clearing {
    clear: right;
    line-height: 0;
  }
</style>
